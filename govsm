#!/bin/bash

INSTALL_DIR="/usr/local"
GO_ARCH="linux-amd64"

list_versions() {
    echo "üîç Obtendo lista de vers√µes dispon√≠veis..."
    curl -s https://go.dev/dl/ | grep -o 'go[0-9]\+\.[0-9]\+\.[0-9]\+' | sort -u
}

install_go() {
    VERSION=$1
    if [[ -z "$VERSION" ]]; then
        echo "‚ö†Ô∏è  Uso: govsm install <vers√£o> (ex: govsm install 1.22.0)"
        exit 1
    fi

    GO_TAR="go${VERSION}.${GO_ARCH}.tar.gz"
    GO_URL="https://go.dev/dl/${GO_TAR}"

    echo "üöÄ Baixando Go ${VERSION}..."
    wget -q ${GO_URL} -O ${GO_TAR}

    echo "üîß Removendo vers√µes anteriores..."
    sudo rm -rf ${INSTALL_DIR}/go

    echo "üì¶ Instalando Go ${VERSION}..."
    sudo tar -C ${INSTALL_DIR} -xzf ${GO_TAR}
    rm ${GO_TAR}

    echo "üîß Configurando vari√°veis de ambiente..."
    export GOROOT=${INSTALL_DIR}/go
    export PATH=$GOROOT/bin:$PATH

    echo "‚úÖ Go ${VERSION} instalado com sucesso!"
    go version
}

if [[ "$1" == "list" ]]; then
    list_versions
elif [[ "$1" == "install" ]]; then
    install_go "$2"
else
    echo "Uso: govsm <comando>"
    echo "Comandos dispon√≠veis:"
    echo "  list           - Lista vers√µes dispon√≠veis para download"
    echo "  install <ver>  - Instala uma vers√£o espec√≠fica do Go"
    echo ""
    echo "Exemplo para instalar a vers√£o 1.21.6:"
    echo "  govsm install 1.21.6"
fi
